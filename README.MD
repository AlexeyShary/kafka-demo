## Общее описание
Реализация системы мониторинга с использованием Spring Kafka.
В проекте реализованы 3 модуля:
- common - модуль общих компонентов для микросервисов: DTO сообщения, утилитарный класс для удобства именования топиков Kafka
- consumer - сервис-потребитель сообщений
- producer - сервис-продюсер сообщений

Сервис-продюсер:
- По запросу POST сервис-продюсер создает сообщение для топика "metrics-topic". В сообщение включены метрики из Actuator - текущее состояние приложения и аптайм.

Сервис-потребитель:
- Читает сообщения из топика "metrics-topic"
- Прочитанные сообщения сохраняются в базе данных
- По GET запросам возможен просмотр всех полученных сообщений или конкретного сообщения по его ID

***

Проверить работоспособность приложения можно вручную, или с использованием прилагаемого интеграционного теста Postman. Алгоритм теста:
- Отправить сообщение от Producer, запомнить uptime, который поставил Producer при отправке
- Получить все записи о полученных сообщениях у Consumer, убедиться что есть запись с uptime, который был сохранен на первом шаге

Для корректной работы теста необходимо запустить коллекцию Integration test.

## API
[Спецификация OpenAPI для Producer](./api/api-docs-producer.json)
[Спецификация OpenAPI для Consumer](./api/api-docs-consumer.json)

При работающем приложении доступен Swagger: 
- http://localhost:8081/swagger-ui/index.html#/ - Сервис-продюсер
- http://localhost:8082/swagger-ui/index.html#/ - Сервис-потребитель

***

[Коллекция Postman](./api/KafkaDemo.postman_collection.json)

Коллекция Postman содержит запросы ко всем эндпоинтам приложения, необходимыми для проверки его работоспособности.

## Запуск приложения
### Вариант 1 - Запуск всего через docker

Сборка сервисов и запуск через docker:

```
./mvnw clean package
docker-compose -f docker-compose-full.yml up
```

Поднимаемые контейнеры:

```
zookeeper - zookeeper для работы Kafaka - 2181:2181
kafka - Брокер сообщений kafka - порты 9092:9092
metrics-db - База данных PostgreSQL - порты 8083:5432
producer-service - Сервис-продюсер - порты 8081:8081
consumer-service - Сервис-потребитель - порты 8082:8082
```

***

### Вариант 2 - Запуск приложения через IDE и Docker контейнер с базой данных

Запуск через docker:

```
docker-compose up
```

Поднимаемые контейнеры:

```
zookeeper - zookeeper для работы Kafaka - 2181:2181
kafka - Брокер сообщений kafka - порты 9092:9092
metrics-db - База данных PostgreSQL - порты 8083:5432
```

Сервисы producer и consumer можно запустить любым удобным способом, например из IDE.

***

Для удобства тестирования база данных metrics-db очищается при каждом запуске приложения.

## Stack

- Java 17
- Spring Boot 3
- Kafka
- JUnit
- PostgreSQL
- Maven
- Docker